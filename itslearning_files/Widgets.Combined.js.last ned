var AddEditFoldersWidget={userInputChanged:!1,data:void 0,onReady:function(){var c=AddEditFoldersWidget.data;parent[c.dashboardLayoutClientInstanceName].toggleModalDialogControls(!0,c.isIe);c.uploadButton.on("click",function(a){parent[c.dashboardLayoutClientInstanceName].toggleModalDialogControls(!1,c.isIe);setTimeout(function(){$(c.uploadButton).prop("disabled",!0)})})},saveBlock:function(){var c=AddEditFoldersWidget.data;c.uploadControl.val()&&!confirm(c.forgotToUploadWarningMessage)?parent[c.dashboardLayoutClientInstanceName].toggleModalDialogControls(!0,
c.isIe):(parent[c.dashboardLayoutClientInstanceName].toggleModalDialogControls(!1,c.isIe),c.saveBlockFunctionWrapper())},initialize:function(){AddEditFoldersWidget.data.titleInput.change(AddEditFoldersWidget.setUserInputChanged);window.parent.BlockHelper.wrapAddEditBlockCancelFunction(function(){return AddEditFoldersWidget.userInputChanged||AddEditFoldersWidget.data.uploadControl.val()},AddEditFoldersWidget.data.contentBlockType)},setUserInputChanged:function(){AddEditFoldersWidget.userInputChanged=
!0}};function RichContentBlock(c){window[c]=this;var a=this;a.initialize=function(){a.controls.blockTitle.change(a.setUserInputChanged);$("#"+a.controls.editorId).change(a.setUserInputChanged);window.parent.BlockHelper.wrapAddEditBlockCancelFunction(function(){var b=!1;try{b=isTextEditorDirty(a.controls.editorId)}catch(e){}return a.userInputChanged||b},a.contentBlockType)};a.setUserInputChanged=function(){a.userInputChanged=!0};return a}
var BlockHelper={getPageInstance:function(){return window.DashboardLayoutInstance},getClientInstance:function(c){return window["BlockClientInstance"+c]?window["BlockClientInstance"+c]:null},getContentWindow:function(){return $("#"+BlockHelper.getPageInstance().settings.dialogIframeName).find("iframe").get(0).contentWindow},addEditBlock:function(c,a){var b=BlockHelper.getClientInstance(a),e=BlockHelper.getPageInstance();if(b.settings.useIframe){e.toggleModalDialogControls(!0,!0);var f=window[e.settings.dialogIframeName];
e.setNewAfterOkClickFunction(function(){BlockHelper.getClientInstance(a).okFunctionWrapper()});(0<b.settings.dialogWidth||0<b.settings.dialogHeight)&&f.setPreferredSize(b.settings.dialogWidth,b.settings.dialogHeight);f.setIframeUrl(b.settings.addEditFrameUrl.replace("ContentBlockId=0","ContentBlockId="+c),!0);f.setTitle(c?b.settings.editDialogTitle:b.settings.addDialogTitle)}else b.customClientFunction&&b.customClientFunction({contentBlockId:c})},wrapAddEditBlockCancelFunction:function(c,a){if(c&&
$.isFunction(c)){var b=function(){return!c()||BlockHelper.getClientInstance(a).cancelFunctionWrapper()};window[BlockHelper.getPageInstance().settings.dialogIframeName].setCloseConfirmation(b);BlockHelper.getPageInstance().setCancelConfirmation(b)}}};function BlockClientInstance(c){window["BlockClientInstance"+c]=this}
function DashboardLayout(c){function a(a,b,c){d.webMethods.deleteContentBlock&&CCL.CommonFunctions.safeAjax({type:"DELETE",url:d.webMethods.deleteContentBlock.replace("{dashboardId}",d.settings.dashboardId).replace("{contentBlockId}",a),data:{isPermanent:b}}).done(c).fail(CommonScripts.jQueryWebServiceErrorHelper)}function b(){p||(p=window[d.settings.dialogIframeName]);return p}function e(){u||(u=b().getFooter().find("input:submit"));return u}function f(b,c){if("#"!=b.title){var e=d.terms.deleteTooltip.replace("{0}",
b.title);var f=d.terms.deletePermanentlyConfirmation.replace("{0}",b.title);var n=d.terms.deletedPermanentlyMessage.replace("{0}",b.title)}else e=d.terms.deleteTooltipNoTitle.replace("{0}",b.type).replace("{1}",b.deletedDate),f=d.terms.deletePermanentlyConfirmationNoTitle.replace("{0}",b.type).replace("{1}",b.deletedDate),n=d.terms.deletedPermanentlyMessageNoTitle.replace("{0}",b.type).replace("{1}",b.deletedDate);var m="reactivate-chk-"+b.contentBlockId;e=$("<a href='javascript:void(0);'>&times;</a>").attr("title",
e).addClass("ilw-removelink h-td-none h-no-print");var k=$("<input type='checkbox' />").attr("value",b.contentBlockId).attr("id",m),p=b.title+(b.type?" - "+b.type:"")+" - "+b.deleted;m=$("<label></label>").text(p).attr("for",m);e.click(function(){var d=$(this);confirm(f)&&a(b.contentBlockId,!0,function(){l(n,"information");d.parent().remove()})});var q=$("<li></li>").addClass("ccl-actionitemlist-separator"),h=$("<div></div>");q.append(e).append(h);c?(h.append(k),d.settings.isFromPage?setTimeout(function(){CCL.ModernCheckbox.BuildCheckbox(k,
p).css("margin-left",0)}):h.append(m)):h.append(m);return q}function l(a,b){var c=$(".ilw-reactivate-feedback",d.controls.reactivatePanel);c.empty();c.append($("<div></div>").addClass("ccl-feedback").addClass(b).append($("<span/>").text(a)))}window[c]=this;var d=this,p,u,t,w,k;d.name=c;d.firstLoad=function(){d.controls.widgetsPickerSubmitOrCancel.hide();d.controls.browseExtensionsLink.click(function(){d.onBrowseExtensionsLinkClickClientScriptFunction();return!1});$(function(){$(function(){e().click(function(a){w&&
w();a.preventDefault()});t||(t=b().getFooter().find("a"));t.click(function(){return t.getIfHyperLinkEnabled()&&(!k||k())})})})};d.setNewAfterOkClickFunction=function(a){w=a};d.setCancelConfirmation=function(a){k=a};d.updateLayoutScheme=function(a,b,c){d.webMethods.updateLayoutScheme&&CCL.CommonFunctions.safeAjax({type:"PUT",url:d.webMethods.updateLayoutScheme.replace("{dashboardId}",d.settings.dashboardId),data:{scheme:a}}).done(b).fail(c)};d.updateLayout=function(a,b,c){d.webMethods.reorderContentBlocks&&
CCL.CommonFunctions.safeAjax({type:"PUT",url:d.webMethods.reorderContentBlocks.replace("{dashboardId}",d.settings.dashboardId),data:{data:a}}).done(b).fail(c)};d.notifyAboutChanges=function(a,b,c,e){d.webMethods.notifyAboutChanges&&CCL.CommonFunctions.safeAjaxPost({url:d.webMethods.notifyAboutChanges,data:{learningObjectId:a,learningObjectInstanceId:b}}).done(c).fail(e)};d.deleteContentBlock=function(b,c){a(b,c,function(a,c){d.onDeleteBlockSuccess(a,c,b)})};d.onDeleteBlockClick=function(a,b){confirm(d.terms.deleteContentBlockConfirmationMessage)&&
d.deleteContentBlock(b,!1)};d.onDeletePlaceholderClick=function(a,b){confirm(d.terms.deletePlaceholderConfirmationMessage)&&d.deleteContentBlock(b,!0)};d.onDeleteAggregatedBlockClick=function(a,b,c){confirm(d.terms.deleteAggregatedContentBlockConfirmationMessage)&&(d.deleteContentBlock(b,!1),toggle_contentblockAddable(c))};d.onDeleteBlockSuccess=function(a,b,c){a=$("li.il-widget").length;WidgetLayout.getWidgetElementsJQuery(c).remove();0==$("li.il-widget").length||a==d.settings.maxNumberOfContentBlocksOnPage?
WidgetLayout._reloadWindow():d.controls.pasteItemPanel.filter(":has(input[value='"+c+"']:hidden)").hide()};d.addContentBlockItsl=function(a){d.webMethods.addContentBlockItsl&&CCL.CommonFunctions.safeAjaxPost({url:d.webMethods.addContentBlockItsl.replace("{dashboardId}",d.settings.dashboardId),data:{blockType:a}}).done(d.onAddContentBlockItslSuccess).fail(CommonScripts.jQueryWebServiceErrorHelper)};d.onAddContentBlockItslSuccess=function(a,b){d.closeDialog(!1);window.location.reload()};d.onAddContentBlockSuccess=
function(){d.toggleModalDialogControls(!1,!0);WidgetLayout._reloadWindow()};d.closeDialog=function(a){a?$(window).unload(function(){CssModal.closeDialog()}):CssModal.closeDialog()};d.toggleModalDialogControls=function(a,d){window[e().parent("div").attr("id")].toggleInProgressState(!a,d);d&&b().toggleDialogCloseButton(a)};d.onCutBlockClick=function(a,b,c){CCL.CommonFunctions.safeAjax({type:"PUT",url:d.webMethods.toggleCutContentBlock.replace("{contentBlockId}",b)}).done(function(){if(b==d.settings.cutContentBlockId)d.settings.cutContentBlockId=
0,d.controls.pasteItemPanel.hide();else if(d.settings.cutContentBlockId=b,d.settings.allowPaste){var a=c?c:"#";d.controls.pasteItemPanel.empty().addClass("ilw-addblock-link-panel").show().append($('<input type="hidden" />').val(b)).append($("<a></a>").attr("href","javascript:void(0);").addClass("ccl-iconlink").addClass(d.settings.pasteImageCssClass).append($("<img />").attr("src",d.settings.onePixelTransparentImageUrl).attr("alt","")).append($("<span></span>").text(d.terms.paste.replace("{0}",a))).on("click",
function(a){d.onPasteBlockClick(a)}))}d.updateCutWidgetState()}).fail(CommonScripts.jQueryWebServiceErrorHelper)};d.updateCutWidgetState=function(){WidgetLayout.getWidgetElementsJQuery(d.settings.cutContentBlockId).addClass("il-widget-cut").find("a.il-widget-cutlink").attr("title",d.terms.undo).find("img").attr("alt",d.terms.undo).prop("className",d.settings.undoImageCssClass);WidgetLayout.getAllWidgetsExceptOne(d.settings.cutContentBlockId).removeClass("il-widget-cut").find("a.il-widget-cutlink").attr("title",
d.terms.cut).find("img").attr("alt",d.terms.cut).prop("className",d.settings.cutImageCssClass)};d.onPasteBlockClick=function(a){CCL.CommonFunctions.safeAjaxPost({url:d.webMethods.pasteContentBlock.replace("{targetDashboardId}",d.settings.dashboardId)}).done(WidgetLayout._reloadWindow).fail(CommonScripts.jQueryWebServiceErrorHelper)};d.beforeOpenWidgetsPicker=function(){var a=WidgetLayout.getCurrentNumberOfWidgets(),b=d.getNumberOfDeletedContentBlocks(),c=window[d.settings.addBlockDialogName];a>=d.settings.maxNumberOfContentBlocksOnPage?
(c.setNewTitle(d.terms.dashboardIsFullHeader),d.controls.widgetsPickerSubmitOrCancel.hide(),d.controls.addItemsPanel.hide(),d.controls.reactivatePanel.hide(),d.controls.bottomPanel.hide(),d.controls.dashboardFullPanel.show(),d.controls.dashboardFullPanel.html(d.terms.dashboardIsFullDescription.replace("{0}",d.settings.maxNumberOfContentBlocksOnPage)).append($("<br />")),b&&d.controls.dashboardFullPanel.append($("<a href='javascript:void(0);'></a>").text(d.terms.reactivateLink).click(d.reactivateLinkClick))):
(c.setNewTitle(d.terms.contentBlocksHeader),d.controls.widgetsPickerSubmitOrCancel.hide(),d.controls.addItemsPanel.show(),d.controls.reactivatePanel.hide(),d.controls.dashboardFullPanel.hide(),d.controls.reactivateLinkPanel.toggle(0<b),d.controls.browseExtensionsLinkPanel.toggle(d.settings.allowBrowseExtensions),d.controls.bottomPanel.toggleClass("ilw-border-top",0<b||d.settings.allowBrowseExtensions),d.controls.bottomPanel.show());WidgetLayout.hideEmbeddedObjects()};d.beforeCloseWidgetsPicker=function(){WidgetLayout.showEmbeddedObjects()};
d.widgetsPickerFocus=function(){d.controls.dashboardFullPanel.is(":visible")?window[d.settings.addBlockDialogName].focusOnCloseLink():d.controls.widgetsPicker.find("li:first a:first").focus()};d.getNumberOfDeletedContentBlocks=function(){var a=0;$.ajax({type:"GET",url:d.webMethods.getNumberOfDeletedContentBlocks.replace("{dashboardId}",d.settings.dashboardId),async:!1,data:{enableEspresso:d.settings.enableEspressoForLocation}}).done(function(d){a=d}).fail(CommonScripts.jQueryWebServiceErrorHelper);
return a};d.reactivateLinkClick=function(){window[d.settings.addBlockDialogName].setNewTitle(d.terms.reactivateContentBlockHeader);d.controls.bottomPanel.hide();d.controls.widgetsPickerSubmitOrCancel.hide();d.controls.addItemsPanel.hide();d.controls.reactivatePanel.hide();d.controls.dashboardFullPanel.hide();$.ajax({type:"GET",url:d.webMethods.getDeletedContentBlocks.replace("{dashboardId}",d.settings.dashboardId),data:{enableEspresso:d.settings.enableEspressoForLocation,useHigherEducationLanguage:d.settings.useHigherEducationLanguage},
dataType:"json"}).done(d.onDeletedBlocksDataReady).fail(CommonScripts.jQueryWebServiceErrorHelper)};d.onDeletedBlocksDataReady=function(a,b){b=WidgetLayout.getCurrentNumberOfWidgets();var c=d.settings.maxNumberOfContentBlocksOnPage>b;d.settings.isFromPage?$(".ilw-reactivate-description").text(d.terms.reactivateDescriptionForPage):c?(b=d.terms.reactivateDescriptionForDashboard.replace("{0}",d.settings.maxNumberOfContentBlocksOnPage-b),$(".ilw-reactivate-description").text(b)):$(".ilw-reactivate-description").empty();
$(".ilw-reactivate-feedback",d.controls.reactivatePanel).empty();b=$(".ilw-reactivate-container",d.controls.reactivatePanel);$(".ilw-reactivate-container",d.controls.reactivatePanel).empty();if(a){var e=$("<ul></ul>").addClass("h-vlist ccl-actionitemlist");$.each(a,function(a,b){a=f(b,c);e.append(a)});b.append(e);d.controls.reactivatePanel.show();c&&d.controls.widgetsPickerSubmitOrCancel.show();a=c?$($(".ilw-reactivate-container input",d.controls.reactivatePanel)):$($(".ilw-reactivate-container a",
d.controls.reactivatePanel));a.length&&a[0].focus()}};d.undeleteElementClick=function(){var a="",b=$(".ilw-reactivate-container ul :checked",d.controls.reactivatePanel);b.each(function(b){b&&(a+=",");a+=$(this).val()});if(!b.length)return l(d.terms.atLeastOneItemHasToSelected,"warning"),!1;var c=WidgetLayout.getCurrentNumberOfWidgets();if(c+b.length>d.settings.maxNumberOfContentBlocksOnPage)return b=d.terms.reactivateBlocksLimitException.replace("{0}",d.settings.maxNumberOfContentBlocksOnPage-c),
l(b,"warning"),!1;d.controls.widgetsPickerSubmitOrCancel.hide();CCL.CommonFunctions.safeAjaxPost({url:d.webMethods.unDeleteContentBlocks.replace("{dashboardId}",d.settings.dashboardId),data:{contentBlocksIds:a}}).done(WidgetLayout._reloadWindow);return!1};d.applyWidgetColor=function(a,b){CCL.CommonFunctions.safeAjax({type:"PUT",url:d.webMethods.setColorScheme.replace("{contentBlockId}",a),data:{colorScheme:parseInt(b)}})};d.repaintWidgetColor=function(a,b){WidgetLayout.getWidgetElementsJQuery(a).find("div.il-widget-header").removeClass().addClass("il-widget-header").addClass(b)};
return d}var EspressoWidget={addInstance:function(c){CCL.CommonFunctions.safeAjaxPost({url:c.settings.webMethodUrl.replace("{dashboardId}",c.settings.dashboardId),data:{blockType:c.settings.blockType}}).done(function(){WidgetLayout._reloadWindow()}).fail(CommonScripts.jQueryWebServiceErrorHelper)}};
function FileStructureList(c){window[c]=this;var a=this;a.name=c;a.sessionKey=null;a.renameTemporaryFolderItemWebMethodUrl=null;a.deleteTemporaryFolderItemWebMethodUrl=null;a.tbody=null;a.deleteConfirmationMessage=null;a.deleteNonEmptyFolderConfirmationMessage=null;a.folderDialogName=null;a.createTemporaryFolderFunction=null;a.currentFolderIdHidden=null;a.createFolderHeader=null;a.renameFolderHeader=null;a.defaultFolderName=null;a.folderTitleClientId=null;a.folderNameEmptyErrorMessage=null;a.renameFolderFunction=
null;a.eventsSender=null;a.renameFileEventName=null;a.deleteFolderItemEventName=null;a.handleFolderName=function(b){return 0==b.length?(alert(a.folderNameEmptyErrorMessage),!1):!0};a.renameTemporaryFolderItem=function(b,c,f,l){f=$.trim(f);c&&!a.handleFolderName(f)||CCL.CommonFunctions.safeAjax({type:"PUT",url:a.renameTemporaryFolderItemWebMethodUrl.replace("{uniqueIdentifier}",b),data:{sessionKey:a.sessionKey,isFolder:c,title:f}}).done(l).fail(CommonScripts.jQueryWebServiceErrorHelper)};a.tryDeleteTemporaryFolderItem=
function(b,c,f){confirm(f?a.deleteNonEmptyFolderConfirmationMessage:a.deleteConfirmationMessage)&&a.deleteTemporaryFolderItem(b,c)};a.deleteTemporaryFolderItem=function(b,c){CCL.CommonFunctions.safeAjax({type:"DELETE",url:a.deleteTemporaryFolderItemWebMethodUrl.replace("{uniqueIdentifier}",b),data:{sessionKey:a.sessionKey,isFolder:c}}).done(function(e,l){a.onDeleteTemporaryFolderItemSuccess(e,l,b,c)}).fail(CommonScripts.jQueryWebServiceErrorHelper)};a.onDeleteTemporaryFolderItemSuccess=function(b,
c,f,l){a.getRowJQuery(f,l).remove();a.eventsSender.trigger(a.deleteFolderItemEventName)};a.createFolder=function(){var b=window[a.folderDialogName];b.setNewAfterOkClickFunction(function(){return a.createFolderOkClick()});b.setNewAfterCancelClickFunction(function(){return a.createFolderCancelClick()});b.setNewTitle(a.createFolderHeader);$("#"+a.folderTitleClientId).val(a.defaultFolderName);b.open()};a.createFolderOkClick=function(){var b=$.trim($("#"+a.folderTitleClientId).val());if(!a.handleFolderName(b))return!1;
a.createTemporaryFolderFunction();return!0};a.createFolderCancelClick=function(){return!0};a.renameFolder=function(b,c){var e=window[a.folderDialogName];e.setNewAfterOkClickFunction(function(){return a.renameFolderOkClick()});e.setNewAfterCancelClickFunction(function(){return a.renameFolderCancelClick()});e.setNewTitle(a.renameFolderHeader);$("#"+a.folderTitleClientId).val(c);e.open();a.renamedFolderId=b};a.renameFolderOkClick=function(){a.renameTemporaryFolderItem(a.renamedFolderId,!0,$("#"+a.folderTitleClientId).val(),
a.renameFolderSuccess);return!1};a.renameFileSuccess=function(){a.eventsSender.trigger(a.renameFileEventName)};a.renameFolderSuccess=function(){a.renameFolderFunction()};a.renameFolderCancelClick=function(){a.renamedFolderId=null;return!0};a.changeCurrentFolder=function(b){a.currentFolderIdHidden.value=b;setTimeout(function(){document.forms[0].submit()})};a.getRowJQuery=function(b,c){return $("tr[id$='"+(c?"fo":"fi")+b+"Row']",a.tbody)};a.focusFolderTitle=function(){$("#"+a.folderTitleClientId).focus()};
return a}
var FoldersWidget={settings:{webMethodUrl:null},getFolderContent:function(c,a){FoldersWidget.settings.webMethodUrl&&$.ajax({type:"GET",url:FoldersWidget.settings.webMethodUrl.replace("{widgetId}",c).replace("{folderId}",a),dataType:"html"}).done(function(a){WidgetLayout.getWidgetElementsJQuery(c).find("ul.ilw-filesblock-ul").html(a)})}},ItslWidgetManager={widgets:[],createServerGeneratedWidget:function(c){var a=new ItslWidget(c);this.widgets[c.widgetId]=a},getWidget:function(c){return this.widgets[c]},getPageInstance:function(){return window.DashboardLayoutInstance},
getClientInstance:function(c){return this.widgets[""+c]?this.widgets[""+c]:null},getContentWindow:function(){return $("#"+ItslWidgetManager.getPageInstance().settings.dialogIframeName).find("iframe").get(0).contentWindow},setWidgetEditSettings:function(c,a){var b=this.getWidget(c);b||(b=new ItslWidget(null),this.widgets[c]=b);b.setEditSettings(a)},addEditBlock:function(c,a,b){if((b=this.widgets[""+a].editSettings)&&"undefined"!=b.addEditPath&&""!=b.addEditPath){var e=b.addEditPath.replace("ContentBlockId=0",
"ContentBlockId="+a),f=window[b.dialogIframeName];ItslWidgetManager.getPageInstance().setNewAfterOkClickFunction(function(){$(this).prop("disabled",!1);ItslWidgetManager.getClientInstance(a).onOkAddEditBlockWrapper()});f.setTitle(a?b.editDialogTitle:b.addDialogTitle);f.setIframeUrl(e.replace("DashboardId=0","DashboardId="+c),!0)}},wrapAddEditBlockCancelFunction:function(c,a){if(c&&$.isFunction(c)){var b=function(){return!c()||ItslWidgetManager.getClientInstance(a).onCancelAddEditBlockWrapper()};window[ItslWidgetManager.getPageInstance().settings.dialogIframeName].setCloseConfirmation(b);
ItslWidgetManager.getPageInstance().setCancelConfirmation(b)}}};function ItslWidget(c){this.settings=c}ItslWidget.prototype.init=function(c){this.load(c)};ItslWidget.prototype.setEditSettings=function(c){this.editSettings=c};ItslWidget.prototype.load=function(c){this.getProgressContainer().show();var a=this;CCL.CommonFunctions.safeAjaxPost({url:this.settings.path,data:this.getRequestParams(c)}).done(function(b){a.getContentContainer().html(b);a.onLoad()})};
ItslWidget.prototype.getRequestParams=function(c){return{widgetSettings:this.settings,widgetCommand:JSON.stringify(c)}};ItslWidget.prototype.onLoad=function(c,a,b){this.getProgressContainer().hide();this.getContentContainer().show();this.updateMenu();this.updateTitle();WidgetLayout.dynamicContentChanged()};ItslWidget.prototype.updateTitle=function(){var c=this._readNewTitle();null!=c&&WidgetLayout.setWidgetTitle(this.settings.widgetId,c)};
ItslWidget.prototype.updateMenu=function(){var c=this._readNewMenu();null!=c&&WidgetLayout.setWidgetMenu(this.settings.widgetId,c)};ItslWidget.prototype.getContainer=function(){return $("#"+this.settings.clientId)};ItslWidget.prototype.getContentContainer=function(){return this.getContainer().find("."+this.settings.cssContentContainer)};ItslWidget.prototype.getProgressContainer=function(){return this.getContainer().find("."+this.settings.cssProgressContainer)};
ItslWidget.prototype._readNewTitle=function(){var c=this.getContainer().find("."+this.settings.cssTitleContainer).html();this.getContainer().find("."+this.settings.cssTitleContainer).remove();return c};ItslWidget.prototype._readNewMenu=function(){var c=this.getContainer().find("."+this.settings.cssFunctionsContainer).html();this.getContainer().find("."+this.settings.cssFunctionsContainer).remove();return c};
ItslWidget.prototype.onOkAddEditBlockWrapper=function(){ItslWidgetManager.getContentWindow()[this.editSettings.addEditDialogClientInstance].addOrEditBlock();return!1};ItslWidget.prototype.onCancelAddEditBlockWrapper=function(){var c=confirm(this.editSettings.cancelConfirmation);c&&window[this.editSettings.dialogIframeName].setIframeUrl("javascript:false;",!0);return c};var PluginWidget={editInstance:function(c){c=eval("PluginWidgetSettings"+c);window.open(c.editPluginUrl,"_blank","resizable=yes,scrollbars=yes,status=yes")}};
function RssWidget(c){window["RssWidget"+c]=this;this.name="RssWidget"+c;this.getFeed=function(){var a=this;$.ajax({type:"GET",url:a.settings.webMethodUrl.replace("{contentBlockId}",a.settings.contentBlockId),dataType:"xml"}).done(function(b){a.createFeed(b)}).fail(function(){a.createErrorReadingFeed()})};this.createFeed=function(a){a=RssHelper.feedToJson(a,this.settings.feedsCount,this.settings.showSummary);this.appendFeedXhtml(a);WidgetLayout.dynamicContentChanged()};this.createErrorReadingFeed=
function(){this.container.empty().append(this.settings.errorReadingFeedMessage+"<br /><br />").append($("<a></a>").text(this.settings.feedsUrl).attr("href",this.settings.feedsUrl).on("click",function(a){window.open($(this).attr("href"));return!1}));WidgetLayout.dynamicContentChanged()};this.appendFeedXhtml=function(a){var b=this,c=$("<ul></ul>").addClass("ilw-rssblock-list");this.container.empty().append(c);$.each(a,function(){var a=this.title;a||(a="#");a=$("<li></li>").addClass("ilw-rssblock-list-item").append($("<a></a>").attr("href",
this.link).addClass("ilw-rssblock-link").addClass("ccl-iconlink").append($("<img />").attr("src",b.settings.onePixelTransparentImageUrl).attr("alt","").addClass(b.settings.cssClasses.rssblockLinkImage)).append($("<span></span>").text(a)).on("click",function(a){window.open($(this).attr("href"));return!1}));if(b.settings.showSummary){var e=$("<div></div>").addClass("ilw-rssblock-list-item-content").html(this.description);e.find("a").on("click",function(a){window.open($(this).attr("href"));return!1});
e.find("object embed").attr("wmode","transparent");a.append(e).append($("<div></div>").addClass("h-fl-c"))}c.append(a)})}}
var RssHelper={userInputChanged:!1,feedToJson:function(c,a,b){var e=[];$("channel",c).length?$("item:lt("+a+")",c).each(function(){var a={link:$(this).find("> link").text(),title:$(this).find("> title").text()};b&&(a.description=$(this).find("> description").text());e.push(a)}):$("feed > entry:lt("+a+")",c).each(function(){var a={link:$(this).find("> link").attr("href"),title:$(this).find("> title").text()};b&&($(this).find("> summary").length?a.description=$(this).find("> summary").text():a.description=
$(this).find("> content").text());e.push(a)});return e},setUserInputChanged:function(){RssHelper.userInputChanged=!0}},StickyTextbox=function(){function c(){setTimeout(function(){0<r.val().trim().length&&!m.isEditorContentEmpty()?v.attr("disabled")&&v.removeAttr("disabled"):v.attr("disabled","disabled")},1)}function a(){A.test(g.textContent)||B.test(g.textContent)?(window[k.modalClientId].setCustomScripts({afterCloseDialog:function(){window.location.reload()}}),CssModal.closeDialog()):(window.WidgetLayout.setWidgetTitle(g.widgetId,
g.titleContent),y.html(g.textContent),q.removeClass(n.classPlaceholderMode),q.addClass(n.classViewMode))}function b(a,b,d,c){var e={};e[g.antiForgery.headerName]=g.antiForgery.headerValue;CCL.CommonFunctions.safeAjax({type:a,url:g.webServiceUrl,data:b,headers:e}).fail(function(){window.CommonScripts.showAlert(x.errorMessage);c&&c()}).done(function(a){d&&d(a)})}function e(a){return g.replaceNewLines?a.replace(/\n/g,"<br/>"):a}function f(a){return g.replaceNewLines?a.replace(/<br\s?\/>/gi,"\n"):a}function l(){if(g.textContent&&
0!==g.textContent.length||!m.isEditorContentEmpty())null==g.textContent&&(g.textContent=""),m.setEditorContent(f(g.textContent),g.editorId,!0)}function d(){if(h)l();else if("undefined"!==typeof CKEDITOR){var a=function(){h.on("blur",c);h.on("change",c);var a=h.editable();a.attachListener(a,"keydown",c);l();a=h.config.oembed||{};a.DialogSrc&&(a.DialogSrc+=g.oEmbedQueryParam)};h=m.getEditorControl();if(h.instanceReady)a();else h.on("instanceReady",function(){a()})}else h=$(m.getEditorControl()),h.on("blur",
c),h.on("keydown",c),h.addClass("ccl-modern-input"),l()}function p(){r.val(g.titleContent);d();c();var a=window[k.modalClientId];a.setCustomScripts({afterOpenDialog:function(){r.focus()}});a.openDialog()}function u(){CssModal.closeDialog()}function t(){var d={title:r.val().trim(),text:e(m.getEditorContent())};if(d.text.length>g.maxContentLength){window.CommonScripts.showAlert(x.contentTooLongMessage.replace("{0}",g.maxContentLength));var c=!1}else c=!0;c&&b("PUT",d,function(b){g.titleContent=b.Title;
g.textContent=b.Text;a();CssModal.closeDialog()},function(){CssModal.closeDialog()})}function w(){window[k.deleteDialogClientId].show().then(function(a){a===CCL.ConfirmDialogResult.Confirm&&b("DELETE",{},function(){g.titleContent="";g.textContent="";window.WidgetLayout.setWidgetTitle(g.widgetId,"");y.html("");q.removeClass(n.classViewMode);q.addClass(n.classPlaceholderMode)})});$("#"+k.deleteDialogClientId).find(":focusable").first().focus()}var k,n,m,g,x,v,z,r,y,q,h,A=/(<img.+id="extension:)|(<img.+id="media:)/i,
B=/(<a.+data-link-id=")/i;return function(a){k=a.properties.clientIds;n=a.properties.classes;m=a.editorFunctions;g=a.properties.stickySettings;x=a.properties.terms;v=$("#"+k.saveButtonClientId);z=$("#"+k.cancelButtonClientId);r=$("#"+k.titleClientId);y=$("#"+k.viewTextClientId);q=$("."+n.classContainer);v.click(t);z.click(u);r.keydown(c);r.on("keyup keypress",function(a){13===a.which&&a.preventDefault()});this.openEditModal=p;this.deleteStickyTextbox=w}}(),ViewImage={showImageDialog:function(c,a,
b){setTimeout(function(){if(window[c]){var e=window[c];e.setNewTitle(b);var f=e.getContainerJQueryElement().find("img.ilw-viewimage-image").prop("alt",b);if(a===f.attr("src"))ViewImage.onImageReady(e);else f.attr("src",a).on("load",function(){ViewImage.onImageReady(e);f.off("load")})}});return!1},onImageReady:function(c){c.open();c.focusOnCloseLink()}};
function VoteAlternativesEditor(c){window[c]=this;this.name=c;this.deleteItem=function(a){a.remove();this.updateAddLink();this.updateAlternateListItems();this.updateHidden();this.events.eventsSender.trigger(this.events.deleteAlternativeEventName)};this.createAlternativeRow=function(){var a=this,b=0!=a.controls.list.find("li").length%2,c=$("<li></li>").addClass(a.cssClasses.listItem+(b?" "+a.cssClasses.listItemAlternate:"")).appendTo(a.controls.list).append($("<input />").attr("type","hidden").val(""));
b=$("<input />").attr("type","text").val("").addClass(a.cssClasses.textbox).appendTo(c).on("blur",function(b){a.updateHidden()});a.settings.canAddOrRemove&&c.append($("<a></a>").attr("href","javascript:void(0);").attr("title",a.settings.deleteTerm).addClass(a.cssClasses.deleteLink).on("click",function(b){a.deleteItem(c)}).append($("<img />").attr("src",a.settings.onePixelTransparentImageUrl).attr("alt",a.settings.deleteTerm).addClass(a.cssClasses.deleteIcon).addClass(a.cssClasses.verticalAlignMiddle)));
a.updateAddLink();b.focus();a.events.eventsSender.trigger(a.events.addAlternativeEventName)};this.updateHidden=function(){var a=this,b=[];a.controls.list.find("li").each(function(){var c=$(this).find("input:hidden").val();c={VoteAlternativeId:c?c:null,Text:$.trim($(this).find("input:text").val())};!c.Text&&a.settings.canAddOrRemove||b.push(c)});a.controls.hiddenField.val(JSON.stringify(b))};this.updateAlternateListItems=function(){this.controls.list.find("li:even").removeClass(this.cssClasses.listItemAlternate);
this.controls.list.find("li:odd").addClass(this.cssClasses.listItemAlternate)};this.updateAddLink=function(){this.controls.list.find("li").length<this.settings.maxNumberOfAlternatives?this.controls.addLink.show():this.controls.addLink.hide()}}
function VoteWidget(c){window["VoteWidget"+c]=this;var a=this;a.name="VoteWidget"+c;a.createContent=function(){a.data.hasVoted?a.data.showResult?a.renderStatisticsScreen():a.renderOwnVoteResultScreen():a.renderRadioButtonsScreen()};a.renderRadioButtonsScreen=function(){var b=a.controls.contentContainer;a.controls.thankYouContainer.hide();b.empty();var c=b.prop("id")+"opt",f=$("<ul></ul>").addClass("ilw-votewidget-list").appendTo(b);$.each(a.data.alternatives,function(){var a=this.VoteAlternativeId,
d=c+a;a=$("<input name='"+c+"' type='radio' />").attr("id",d).val(a.toString()).on("click",function(){b.find("input:submit").prop("disabled",!1)});f.append($("<li></li>").addClass("ilw-votewidget-list-item").append(a).append($("<label></label>").attr("for",d).text(this.Text)));this.IsSelected&&a.prop("checked",!0)});$("<input />").attr("type","submit").addClass(a.settings.cssClasses.buttonStyle).addClass(a.settings.cssClasses.noPrint).prop("disabled",!0).on("click",function(){a.vote();return!1}).val(a.terms.vote).appendTo(b);
a.renderViewResultLink();WidgetLayout.dynamicContentChanged()};a.renderOwnVoteResultScreen=function(){var b=a.controls.contentContainer;a.controls.thankYouContainer.show();b.empty();var c=$("<ul></ul>").addClass("ilw-votewidget-ownvote-list").appendTo(b);$.each(a.data.alternatives,function(){var b=this.Text,e=$("<li></li>").addClass("ilw-votewidget-ownvote-list-item").appendTo(c);this.IsSelected?e.append($("<span></span>").addClass("ilw-votewidget-ownvote-list-item-chosenalternativetext").text(b)).append(document.createTextNode(" ("+
a.terms.yourVote+")")):e.text(b)});a.renderChangeYourVoteLink($("<div></div>").addClass(a.settings.cssClasses.marginTop10).appendTo(b));WidgetLayout.dynamicContentChanged()};a.renderStatisticsScreen=function(){var b=a.controls.contentContainer;a.controls.thankYouContainer.hide();b.empty();var c=$("<div></div>").appendTo(b);if(a.data.hasAnyoneVoted){var f=$("<div></div>").addClass("ilw-votewidget-stat-imagecontainer").appendTo(c);setTimeout(function(){a.renderChart(f)});a.renderLegend(c)}else c.text(a.terms.noOneHasVoted);
a.data.displayNumberOfVotes&&b.append($("<div></div>").addClass("h-fl-r").text(a.terms.totalOfVotes.replace("{0}",a.data.numberOfVotes)).appendTo(b)).append($("<div></div>").addClass("h-fl-c"));b=$("<div></div>").addClass(a.settings.cssClasses.marginTop10).appendTo(b);a.data.hasVoted&&b.append($("<span></span>").addClass(a.settings.cssClasses.verticalAlignMiddle).html(a.terms.youVoted+": "+a.getSelectedAlternativeText()+". "));a.renderChangeYourVoteLink(b);WidgetLayout.dynamicContentChanged()};a.renderChart=
function(b){var e=VoteChartUrl+"?ContentBlockId="+c+"&ViewAsPersonId="+a.data.voteAsPersonId+"&stamp="+(new Date).getTime();b.append($("<img />").attr("alt","").attr("src",e).load(function(){WidgetLayout.dynamicContentChanged()}))};a.renderLegend=function(b){var c=$("<ul></ul>").addClass("ilw-votewidget-stat-list").appendTo(b),f=a.settings.chartColors,l=f.length;$.each(a.data.alternatives,function(b,e){c.append($("<li></li>").addClass("ilw-votewidget-stat-list-item").append($("<span></span>").addClass("ilw-votewidget-stat-list-item-bullet").css("background-color",
f[b%l]).html("&nbsp;")).append($("<span></span>").addClass("ilw-votewidget-stat-list-item-description").text(e.Text).append($("<span></span>").addClass("ilw-votewidget-stat-list-item-percentage").text(" ("+e.PercentOfVotes.toString().replace(".",a.settings.decimalSeparator)+"%)"))))})};a.renderViewResultLink=function(){a.data.showResult&&$("<div></div>").addClass(a.settings.cssClasses.marginTop10).append($("<a></a>").addClass(a.settings.cssClasses.iconLink).addClass(a.settings.cssClasses.noPrint).attr("href",
"javascript:void(0);").on("click",function(){a.updateWidgetData(!0)}).append($("<span></span>").text(a.terms.viewResult))).appendTo(a.controls.contentContainer)};a.renderChangeYourVoteLink=function(b){!a.data.canChangeTheVote&&a.data.hasVoted||b.append($("<a></a>").addClass(a.settings.cssClasses.iconLink).addClass(a.settings.cssClasses.noPrint).attr("href","javascript:void(0);").on("click",function(){a.renderRadioButtonsScreen()}).append($("<span></span>").text(a.data.hasVoted?a.terms.changeYourVote:
a.terms.clickHereToVote)))};a.getSelectedAlternativeText=function(){var b="";$.each(a.data.alternatives,function(){this.IsSelected&&(b=CCL.CommonFunctions.htmlEncode(this.Text))});return b};a.vote=function(){var b=a.controls.contentContainer,c=b.find("input:radio:checked").val();c&&(b.find("input:submit").prop("disabled",!0),CCL.CommonFunctions.safeAjaxPost({url:a.webMethods.vote.replace("{widgetId}",a.data.widgetId).replace("{alternativeId}",c),dataType:"json",data:a.data.voteAsPersonId}).done(function(b){a.data=
b;a.createContent()}).fail(function(b){CommonScripts.jQueryWebServiceErrorHelper(b);a.controls.contentContainer.find("input:submit").prop("disabled",!1)}))};a.updateWidgetData=function(b){$.ajax({type:"GET",url:a.webMethods.getVoteWidgetData.replace("{widgetId}",a.data.widgetId)+"?ViewAsPersonId="+a.data.voteAsPersonId,dataType:"json"}).done(function(c){a.data=c;b&&a.data.showResult?a.renderStatisticsScreen():a.createContent()}).fail(CommonScripts.jQueryWebServiceErrorHelper)}}
var VoteWidgetHelper={userInputChanged:!1,setUserInputChanged:function(){VoteWidgetHelper.userInputChanged=!0}};

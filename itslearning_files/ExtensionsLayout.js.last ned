function ExtensionsLayout(m){function n(b){p=b;b.length?(a.controls.searchResultLabel.find("span:first").text("'"+b+"'"),a.controls.searchResultLabel.show()):a.controls.searchResultLabel.hide();CCL.CommonFunctions.safeAjaxPost({url:c.webMethods.measureSearch,data:{searchText:b},error:d});if(b=window[a.pagerInstanceName])b.pageNumber=1;h(q)}function h(b,e){var k=window[a.pagerInstanceName];CCL.CommonFunctions.safeAjaxPost({url:c.webMethods.renderExtensionsMatrixMarkup,data:{extensionsLayoutClientInstanceName:m,
extensionType:g,isLibraryMode:c.isLibraryMode,placement:a.settings.placement,sorting:f.val(),filtering:p,pageNumber:k?k.pageNumber:1,organisationId:c.organisationId,ignoreExtensionPreselection:c.ignoreExtensionPreselection,isDeepLinkingSupported:c.isDeepLinkingSupported},dataType:"JSON",success:function(c,d){k.totalCount=c.VirtualCount;a.controls.matrixContainer.html(c.HtmlMarkup);r();null!=b&&b(e)},error:d})}function r(){a.controls.matrixContainer.toggleClass(c.cssClasses.noApps,a.controls.matrixContainer.is(":has(."+
c.cssClasses.notFoundInner+")"))}function q(){var b=window[a.pagerInstanceName];b&&(0==b.totalCount?b.hide():b.render())}function d(a,e,d){a.status>=CCL.CommonConstants.httpStatusCodes.badRequest&&alert(a.responseText?$("<div/>").html(a.responseText).text():c.terms.generalErrorMessageText)}window[m]=this;var a=this,c,f,g,l=!1,p="";a.initialize=function(){c=a.settings;f=a.controls.sortDropdown;searchBox=a.controls.searchBox;g=c.extensionType;f.change(function(){var b=window[a.pagerInstanceName];b&&
(b.pageNumber=1);CCL.CommonFunctions.safeAjax({type:"PUT",url:c.webMethods.updateSortingPreference,data:{sorting:f.val()},error:d});h(q)});searchBox.bind(a.settings.clientEvents.textSearch,function(a,c){n(c)});r()};a.beforeOpenDialog=function(){a.customScripts.beforeDialogOpened&&a.customScripts.beforeDialogOpened()};a.afterOpenDialog=function(){f.focus();CCL.CommonFunctions.safeAjaxPost({url:c.webMethods.registerDialogOpened,data:{placement:a.settings.placement}})};a.beforeCloseDialog=function(){l&&
a.customScripts.afterMultipleExtensionsRemoveAndClose&&a.customScripts.afterMultipleExtensionsRemoveAndClose();a.customScripts.beforeDialogClosed&&a.customScripts.beforeDialogClosed()};var t=function(b,c){a.customScripts.afterExtensionInclude&&(a.controls.changedExtensionsHidden.val(b),a.customScripts.afterExtensionInclude({extensionId:b,extensionTitle:c}))};a.toggleExtension=function(b,e,f){CCL.CommonFunctions.safeAjax({type:"PUT",url:c.webMethods.toggleExtension,async:!1,data:{extensionType:g,extensionId:b,
include:e},success:function(d,g){e?(c.expandFramesWhenInclude&&window[a.settings.dialogClientInstanceName].toggleContentAreaFrame(!1),t(b,f),l=!1,window[a.settings.dialogClientInstanceName].close()):l=!0;h()},error:d})};a.registerExtensionUse=function(b,e){CCL.CommonFunctions.safeAjaxPost({url:c.webMethods.registerExtensionUse,async:!1,data:{extensionType:g,extensionId:b},success:function(){t(b,e);window[a.settings.dialogClientInstanceName].close()},error:d})};a.onPageChange=function(b){var c=window[a.pagerInstanceName];
c.pageNumber=b.pageNumber;h(c.render)};a.clearSearch=function(){window[a.searchBoxInstanceName].clearSearch();n("")};return a};
